source("~/studDir/DS_R/lab8/main.r", echo = TRUE)
source("~/studDir/DS_R/lab8/main.r", echo = TRUE)
warnings()
barplot(err_compare, beside = TRUE, names.arg = c("Женщины", "Мужчины"),
col = c("tomato", "dodgerblue"),
main = "Ошибки: до и после балансировки", ylab = "Ошибка, %",
legend.text = c("До", "После"), args.legend = list(x = "topright"))
source("~/studDir/DS_R/lab8/main.r", echo = TRUE)
# Загрузка библиотеки
library(e1071)
# Загрузка данных
data <- read.csv("nbtrain.csv", stringsAsFactors = TRUE)
# Разделение на обучающую и тестовую выборки
train <- data[1:9010, ]
test <- data[9011:10010, ]
# a) Построение классификатора для предсказания дохода
model_income <- naiveBayes(income ~ age + sex + educ, data = train)
# Априорные вероятности классов
cat("Априорные вероятности:\n")
print(model_income$apriori)
# Условные вероятности признаков
cat("\nУсловные вероятности:\n")
print(model_income$tables)
# b) Предсказание на тестовых данных
pred_income <- predict(model_income, test)
# Матрица ошибок
cat("\nМатрица ошибок (income):\n")
conf_income <- table(Actual = test$income, Predicted = pred_income)
print(conf_income)
# Расчет ошибок классификации
total_error <- 1 - sum(diag(conf_income)) / sum(conf_income)
cat("\nОбщая ошибка классификации:", round(total_error * 100, 2), "%\n")
# Ошибки по классам
classes <- levels(test$income)
for (cl in classes) {
class_total <- sum(conf_income[cl, ])
class_correct <- conf_income[cl, cl]
class_error <- 1 - class_correct / class_total
cat("Ошибка для", cl, ":", round(class_error * 100, 2), "%\n")
}
# a) Классификатор для предсказания пола
model_sex <- naiveBayes(sex ~ age + educ + income, data = train)
pred_sex <- predict(model_sex, test)
cat("\nМатрица ошибок (sex):\n")
conf_sex <- table(Actual = test$sex, Predicted = pred_sex)
print(conf_sex)
# Ошибки классификации по полу
total_error_sex <- 1 - sum(diag(conf_sex)) / sum(conf_sex)
cat("\nОбщая ошибка (sex):", round(total_error_sex * 100, 2), "%\n")
for (s in levels(test$sex)) {
s_total <- sum(conf_sex[s, ])
s_correct <- conf_sex[s, s]
s_error <- 1 - s_correct / s_total
cat("Ошибка для", s, ":", round(s_error * 100, 2), "%\n")
}
# b) Балансировка данных по полу
set.seed(42)
train_f <- train[train$sex == "F", ]
train_m <- train[train$sex == "M", ]
# Случайная выборка по 3500 записей
sample_f <- train_f[sample(nrow(train_f), 3500), ]
sample_m <- train_m[sample(nrow(train_m), 3500), ]
train_balanced <- rbind(sample_f, sample_m)
# Перестроение модели
model_sex_bal <- naiveBayes(sex ~ age + educ + income, data = train_balanced)
cat("\nАприорные вероятности (сбалансированные данные):\n")
print(model_sex_bal$apriori)
cat("\nУсловные вероятности (сбалансированные данные):\n")
print(model_sex_bal$tables)
# c) Оценка на тестовых данных
pred_sex_bal <- predict(model_sex_bal, test)
cat("\nМатрица ошибок (сбалансированная модель):\n")
conf_sex_bal <- table(Actual = test$sex, Predicted = pred_sex_bal)
print(conf_sex_bal)
total_error_bal <- 1 - sum(diag(conf_sex_bal)) / sum(conf_sex_bal)
cat("\nОбщая ошибка (сбалансированная):", round(total_error_bal * 100, 2), "%\n")
for (s in levels(test$sex)) {
s_total <- sum(conf_sex_bal[s, ])
s_correct <- conf_sex_bal[s, s]
s_error <- 1 - s_correct / s_total
cat("Ошибка для", s, ":", round(s_error * 100, 2), "%\n")
}
# d) Повторение эксперимента несколько раз
cat("\nРезультаты нескольких итераций балансировки:\n")
errors_iter <- numeric(5)
for (i in 1:5) {
sample_f_i <- train_f[sample(nrow(train_f), 3500), ]
sample_m_i <- train_m[sample(nrow(train_m), 3500), ]
train_bal_i <- rbind(sample_f_i, sample_m_i)
model_i <- naiveBayes(sex ~ age + educ + income, data = train_bal_i)
pred_i <- predict(model_i, test)
conf_i <- table(Actual = test$sex, Predicted = pred_i)
errors_iter[i] <- 1 - sum(diag(conf_i)) / sum(conf_i)
cat("Итерация", i, "- Общая ошибка:", round(errors_iter[i] * 100, 2), "%\n")
}
# Графики (сохраняем в PDF)
pdf("graphs.pdf", width = 10, height = 8)
# 1. Ошибки классификации по классам дохода
err_income <- c(
1 - conf_income["10-50K", "10-50K"] / sum(conf_income["10-50K", ]),
1 - conf_income["50-80K", "50-80K"] / sum(conf_income["50-80K", ]),
1 - conf_income["GT 80K", "GT 80K"] / sum(conf_income["GT 80K", ])
)
par(mfrow = c(2, 2), mar = c(4, 4, 3, 1))
barplot(err_income * 100, names.arg = c("10-50K", "50-80K", "GT 80K"),
col = c("steelblue", "coral", "seagreen"),
main = "Ошибки по классам дохода", ylab = "Ошибка, %",
ylim = c(0, 100))
# 2. Сравнение ошибок для пола (до и после балансировки)
err_sex_before <- c(
1 - conf_sex["F", "F"] / sum(conf_sex["F", ]),
1 - conf_sex["M", "M"] / sum(conf_sex["M", ])
)
err_sex_after <- c(
1 - conf_sex_bal["F", "F"] / sum(conf_sex_bal["F", ]),
1 - conf_sex_bal["M", "M"] / sum(conf_sex_bal["M", ])
)
err_compare <- rbind(err_sex_before * 100, err_sex_after * 100)
barplot(err_compare, beside = TRUE, names.arg = c("Женщины", "Мужчины"),
col = c("tomato", "dodgerblue"),
main = "Ошибки: до и после балансировки", ylab = "Ошибка, %",
legend.text = c("До", "После"), args.legend = list(x = "topright"))
# 3. Матрица ошибок для дохода (тепловая карта)
conf_norm <- prop.table(conf_income, margin = 1) * 100
image(1:3, 1:3, t(conf_norm)[, 3:1], col = heat.colors(20),
axes = FALSE, xlab = "Предсказано", ylab = "Реально",
main = "Матрица ошибок (income)")
axis(1, at = 1:3, labels = colnames(conf_income))
axis(2, at = 1:3, labels = rev(rownames(conf_income)))
for (i in 1:3) {
for (j in 1:3) {
text(i, 4 - j, round(conf_norm[j, i], 1))
}
}
# 4. Ошибки по итерациям
plot(1:5, errors_iter * 100, type = "b", pch = 19, col = "darkgreen",
xlab = "Итерация", ylab = "Ошибка, %",
main = "Стабильность модели", ylim = c(40, 55))
abline(h = mean(errors_iter) * 100, lty = 2, col = "gray")
dev.off()
cat("\nГрафики сохранены в graphs.pdf\n")
barplot(err_income * 100, names.arg = c("10-50K", "50-80K", "GT 80K"),
col = c("steelblue", "coral", "seagreen"),
main = "Ошибки по классам дохода", ylab = "Ошибка, %",
ylim = c(0, 100))
# 2. Сравнение ошибок для пола (до и после балансировки)
err_sex_before <- c(
1 - conf_sex["F", "F"] / sum(conf_sex["F", ]),
1 - conf_sex["M", "M"] / sum(conf_sex["M", ])
)
err_sex_after <- c(
1 - conf_sex_bal["F", "F"] / sum(conf_sex_bal["F", ]),
1 - conf_sex_bal["M", "M"] / sum(conf_sex_bal["M", ])
)
err_compare <- rbind(err_sex_before * 100, err_sex_after * 100)
barplot(err_compare, beside = TRUE, names.arg = c("Женщины", "Мужчины"),
col = c("tomato", "dodgerblue"),
main = "Ошибки: до и после балансировки", ylab = "Ошибка, %",
legend.text = c("До", "После"), args.legend = list(x = "topright"))
# 3. Матрица ошибок для дохода (тепловая карта)
conf_norm <- prop.table(conf_income, margin = 1) * 100
image(1:3, 1:3, t(conf_norm)[, 3:1], col = heat.colors(20),
axes = FALSE, xlab = "Предсказано", ylab = "Реально",
main = "Матрица ошибок (income)")
axis(1, at = 1:3, labels = colnames(conf_income))
axis(2, at = 1:3, labels = rev(rownames(conf_income)))
for (i in 1:3) {
for (j in 1:3) {
text(i, 4 - j, round(conf_norm[j, i], 1))
}
}
# 4. Ошибки по итерациям
plot(1:5, errors_iter * 100, type = "b", pch = 19, col = "darkgreen",
xlab = "Итерация", ylab = "Ошибка, %",
main = "Стабильность модели", ylim = c(40, 55))
abline(h = mean(errors_iter) * 100, lty = 2, col = "gray")
dev.off()
cat("\nГрафики сохранены в graphs.pdf\n")
# 1. Ошибки классификации по классам дохода
err_income <- c(
1 - conf_income["10-50K", "10-50K"] / sum(conf_income["10-50K", ]),
1 - conf_income["50-80K", "50-80K"] / sum(conf_income["50-80K", ]),
1 - conf_income["GT 80K", "GT 80K"] / sum(conf_income["GT 80K", ])
)
barplot(err_income * 100, names.arg = c("10-50K", "50-80K", "GT 80K"),
col = c("steelblue", "coral", "seagreen"),
main = "Ошибки по классам дохода", ylab = "Ошибка, %",
ylim = c(0, 100))
# 2. Сравнение ошибок для пола (до и после балансировки)
err_sex_before <- c(
1 - conf_sex["F", "F"] / sum(conf_sex["F", ]),
1 - conf_sex["M", "M"] / sum(conf_sex["M", ])
)
err_sex_after <- c(
1 - conf_sex_bal["F", "F"] / sum(conf_sex_bal["F", ]),
1 - conf_sex_bal["M", "M"] / sum(conf_sex_bal["M", ])
)
err_compare <- rbind(err_sex_before * 100, err_sex_after * 100)
barplot(err_compare, beside = TRUE, names.arg = c("Женщины", "Мужчины"),
col = c("tomato", "dodgerblue"),
main = "Ошибки: до и после балансировки", ylab = "Ошибка, %",
legend.text = c("До", "После"), args.legend = list(x = "topright"))
source("~/studDir/DS_R/lab8/main.r", echo = TRUE)
source("~/studDir/DS_R/lab8/main.r")
source("~/studDir/DS_R/lab8/main.r")
source("~/studDir/DS_R/lab8/main.r")
source("~/studDir/DS_R/lab8/main.r")
source("~/studDir/DS_R/lab8/main.r")
source("~/studDir/DS_R/lab8/main.r", echo = TRUE)
source("~/studDir/DS_R/lab8/main.r", echo = TRUE)
source("~/studDir/DS_R/lab8/main.r", echo = TRUE)
